

# 最近会话更新逻辑

所有频道：

- 客户端点击频道的时候更新
- 用户同步最近会话的时候，会检查最近会话数量，如果超过最大数量的一半，将加入定时任务里，定时任务会定时清理不是频道订阅者并且设置的时间内没有消息的最近会话

个人频道：
- 如果开启了白名单，则在添加白名单的时候更新
- 如果没开启白名单，则通过消息触发更新，当消息序号是1的时候更新（如果更新失败，可能会丢失最近会话，如果失败先记录到日志里）

群频道：
- 添加群成员的时候更新
    
命令频道
- 每条消息触发，流程：先查询订阅者是否有此最近会话，有则忽略，没有则更新（比较消耗性能，可以合并批量处理）

